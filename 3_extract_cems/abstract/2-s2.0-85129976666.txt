Multi-energy microgrid is one of the effective technological methods for multi-energy complementation. Taking the electricity-heat-gas multi-energy microgrid with power-to-gas and battery-supercapacitor hybrid energy storage system as the research object, as for the credibility of optimal control results of system is lower due to the uncertainties of wind power output, photovoltaic output and load demand, the multi-time-scale two-layer receding horizon optimal control method that contains long time-scale receding horizon optimization layer and short time-scale real-time receding horizon adjustment layer based on the receding horizon optimal idea of model predictive control is proposed. In this model, the upper layer takes the optimal operating economy of system as the objective, and the scheduling plan in long time-scale is formulated by multi-step receding horizon solution, while the lower layer takes tracing and correcting scheduling plan in upper layer as the objective, and the supercapacitor is introduced to further deal with the power fluctuations of wind power, photovoltaic and load demand in short time-scale based on smoothing the power fluctuation by rece-ding horizon optimization in short time-scale. The analysis results show that the power-to-gas and supercapacitor have significant effects on increasing the absorption ability of multi-energy microgrid and smoothing the power fluctuation of system, meanwhile the two-layer receding horizon optimal control method can mitigate the effects of uncertain elements on optimal control of system under the premise of guaranteeing the economic operation of multi-energy microgrid.