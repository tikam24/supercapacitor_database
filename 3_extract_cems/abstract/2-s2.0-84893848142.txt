A UPQC (United Power Quality Conditioner) is proposed for microgird, which is composed of supercapacitor, photovoltaic modules, Boost-Buck DC/DC converter, bidirectional DC/DC converter, shunt inverter and energy management system. Its structure is analyzed and it is proposed to generate the control instruction according to different power quality problems for grid-connected UPQC. The connecting module between supercapacitor and shunt inverter and the power charging module of supercapaciter are designed. The simulative results verify that, the proposed UPQC takes full advantage of the redundant power of photovoltaic cells and the rapid response capability of supercapacitors to solve various power quality problems of microgrid.