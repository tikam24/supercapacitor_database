In the process of preparing heteroatom-doped carbon materials by activating biomass with conventional activators (e.g. KOH or NaOH), not only the activators are highly corrosive to the equipment, but also the heteroatom content of the prepared carbon materials is low, which limits their large-scale production. In this study, a green method was proposed to synthesize nitrogen-oxygen co-doped porous carbons in one step under air atmosphere. In the preparation process, macadamia nut shells, potassium chloride(KCl) and melamine were used as precursors, templating agents and nitrogen sources, respectively. KCl can be used as a flame retardant to allow pyrolysis in the gas stream. This process promotes pore formation and the introduction of oxygen species. The presence of KCl also reduced the loss of nitrogen during pyrolysis. The prepared porous carbon had a high nitrogen and oxygen content of 20.2 wt% and 23.3 wt%, respectively. The highest CO2 uptake of the samples was 1.39 mmol/g at 0.15 bar and 25 °C, with a selectivity of 39.33. In addition, the material exhibited an impressive specific capacitance of 254.5 F g−1 at 1 A g−1. The unique green preparation method is expected to provide new ideas for post-combustion CO2 capture and energy storage.