The hybrid energy storage system (HESS), which consists of ultra-capacitors and battery packs, is able to prevent the battery from the large current impact, increase instantaneous power capacity, so the battery is working under the reasonable status and the peak electric power requirement from the vehicle can be fulfilled. In this paper, a type of HESS containing DC-DC converter module, battery pack, and the ultra-capacitor is analyzed. Then, a novel online optimization-based nonlinear model predictive control (NMPC) power allocation strategy for the HESS is proposed. By introducing the vehicle velocity, control-oriented engine model, and the electro-mechanical transmission plant model, the electric power demand of the vehicle in the future can be predicted. The model of HESS is built in MATLAB/Simulink based on the predicted electric power requirement under the circumstance of a certain heavy-duty driving cycle. Moreover, the proposed strategy is verified through the physical test bench. The simulation and bench test results show the advantages of the HESS that is able to enhance the overall instantaneous power and prevent the battery from overload. Meanwhile, compared with the results of single battery storage system and the HESS with logic threshold control method, the proposed NMPC-based power allocation strategy can lower the peak power of the battery in the HESS, reduce the average charge and discharge power of the battery pack, and decrease the change in frequency and amplitude of the electric power. It will prevent the battery pack from over discharging/charging and improve the overall efficiency of the HESS.