Supercapacitor based Energy Storage Systems (ESS) have been used to perform power smoothing in variable renewable energies connected to grid. By suitable design, the stored energy of this equipment could also be used to supply virtual inertia to grid, thus increasing the grid stability in front of frequency events and transient power imbalance. This possibility is explored in the paper by the implementation of a suitable control strategy of a two-stage converter that integrates the supercapacitor ESS to perform simultaneously power smoothing and virtual inertia supply. This way, the converter operates like a power filter that improves the grid stability. Hardware-in-the-loop (HIL) simulation results for a 5 kW system are presented.