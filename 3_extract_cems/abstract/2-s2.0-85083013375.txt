Under partial shading condition, the power output characteristics of occluded PV modules and unoccluded PV modules in traditional PV arrays are inconsistent, which results in the total power output curve of the photovoltaic array having multiple peaks. Therefore, this paper uses the power generation-energy storage dual function of Solar Cell-Supercapacitor Device (SCSD) to construct a photovoltaic array based on SCSD, and analyzes the mathematical model and working characteristics of SCSD under normal illumination and partial shading. On this basis, it puts forward a charge and discharge control method based on switch network. Under the partial shading, the switch network transformation can not only independently control the SCSD and realize the compensation of the photovoltaic power deficiency by the supercapacitor of the SCSD, but also control the cooperation of the supercapacitor of multiple SCSD to compensate the photovoltaic power deficiency. Lastly, it is verified by Matlab simulation that the method proposed in this paper can not only effectively avoid the unbalanced problem of energy storage battery pack, but also restore the PV array output power curve to a single peak under the local shadow and minimize the photovoltaic power fluctuation under the local shadow.