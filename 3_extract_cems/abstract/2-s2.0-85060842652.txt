The virtual synchronous generator with the hybrid energy storage system consisting of battery and ultracapacitor allows the inverter to better simulate the inertia of the synchronous generator. When the power fluctuation occurs in the system., by introducing voltage deviation to make the fluctuation reasonably distributed between battery and ultracapacitor. In order to extend the service life of the battery to some extent., a control strategy with battery state of charge (SOC) feedback is proposed. By mode switching., the battery can stop charging when the SOC reaches the upper limit. The simulation model was built in Simulink and the method was verified by analyzing the operation of the battery in the stage of normal charge and discharge and the charge reached the upper limit.