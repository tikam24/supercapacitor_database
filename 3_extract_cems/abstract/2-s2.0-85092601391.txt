Energy storage system plays an important role in modern power systems. In this article, a two-stage three-port hybrid energy storage system (HESS) in dc microgrids (MGs) is proposed. Based on the analysis of topology and operating principle of HESS, a phase shift and duty-cycle combined control is adopted. In order to analyze the power transmission characteristics between the high- and low-voltage sides of the HESS, a mathematical derivation is carried out. Furthermore, an autonomous power sharing control strategy based on virtual impedance is proposed considering the operational requirements of HESS in dc MGs. Accordingly, the overall control scheme of the two-stage three-port HESS is presented. On this basis, by using the generalized state-space averaging modeling, both the converter model and the system control model are established. The influences of virtual impedance parameters and state of charge (SoC) of supercapacitor (SC) on the dynamic behavior and system stability are obtained. Finally, an experimental prototype of the proposed HESS is constructed to verify the validity of the phase shift and duty-cycle combined control. Meanwhile, the effectiveness of the power sharing control scheme of the HESS in dc MGs is demonstrated under various experimental scenarios.