In energy generation through photovoltaics panels with micro-inverter, batteries are used to compensate the solar energy intermittent nature. Batteries loses their lifespan when are used with sudden loads changes due their low power density. To overcome this, this paper proposes the use of a hybrid energy storage system, which is composed of a battery and a supercapacitor. Each element is controled by a DC-DC bidirectional converter through virtual impedance. In addition to the storage system, the overall system consists of a 300[W] photovoltaic panel controlled by a Boost converter by input-output feedback linearization and a three-phase inverter controlled in the Park plane by PI control. From the dynamic models of the converters, the control of each one is designed and simulated in PSIM. It is obtained that in the load impacts, the supercapacitor current dampens the battery current. Besides in the steady state the supercapacitor current is zero. This shows that the use of a hybrid energy storage system protects the battery in sudden loads, taking advantage of the characteristics of each energy storage element.