Incorporating energy storage system properly into the photovoltaic plant can improve the power quality and economic benefits effectively. Taking battery-supercapacitor hybrid energy storage system as an example, the paper calculated the depth of battery using the rain-flow-counting method, and established battery life quantitative model according to the equivalent cycle life curve. By analyzing the cost structure of the energy storage system, the paper established capacity allocation model using the minimum annual cost as objective, fluctuation rate and confidence as constraints. Simulation calculation used the particle swarm algorithm, and the results show the validity of the method. The simulation results also show that hybrid energy storage system can greatly reduce the operating costs and improve the economy of PV-energy storage system compared with a single type of battery energy storage system. Â© 2013 Chin. Soc. for Elec. Eng.