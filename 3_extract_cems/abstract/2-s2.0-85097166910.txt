This paper proposes the design, analysis and control of a Unified Power Quality Conditioner with embedded hybrid energy storage, based on supercapacitors and Li-ion batteries for power condition in distribution grids. The proposed system is able to compensate voltage sags and swells, current unbalances as well as operation in grid-forming mode when required. The paper is focused on the complete system design, including the power stage, energy storage and control system. System operation is assessed by using a real profile obtained from a power meter installed in an industrial installation.