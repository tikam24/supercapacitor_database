Today, the use of DC power equipments is increasing due to the cost-effective use of energy and decreasing power losses in the conversions. Generally in microgrids the hybrid energy storage system (HESS) composed of battery and supercapacitor (SC) is used to improve the microgrid reliability and increase battery and supercapacitor lifetime. Maintaining the SOC of battery and supercapacitor in permissible range is an important task to offset the uncertainty of renewable energy sources. Therefore, the energy management system plays an important role in continuous and reliable operation of the microgrid. In this paper, a DC microgrid including photovoltaic cells, battery and supercapacitor with the proposed control system is modeled and simulated. The purpose of the proposed control system is performance improvement of supercapacitors and their proper operation during step load changes. In the proposed supercapacitor control system, the double loop voltage-current controller with virtual impedance loop is used, which makes the supercapacitor current become zero during steady state of the system and produces a surge current during step load changes. The purpose of the proposed control scheme is to increase the efficiency of HESS specially SC in the case of step load change and voltage transients in the islanded DC microgrid system. The proposed control system is simulated by Matlab/Simulink and its effectiveness is evaluated under different scenarios and the results are analyzed.