This paper proposes a cooperative control for power sharing and energy balancing between heterogeneous energy storage devices, improving reliability, flexibility, and scalability. The batteries are controlled in a distributed fashion, over a sparse communication network, while decentralized control is used for the ultracapacitors. The virtual impedance control strategy allocates the high frequency component of the loads to the ultracapacitors and the low frequency component to the batteries, without using filters. Presented simulation results verify the performance of the proposed strategy for an islanded DC microgrid with variable loads.