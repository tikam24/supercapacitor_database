In subway systems, electrical trains can generate considerable regenerative braking energy while braking, and such energy can be fed back to the contact line for further reuse by other accelerating trains, or dissipated by heating resistors. In order to reduce the total energy consumption during the operations of trains, a critical problem involves how to enhance the utilization of regenerative braking energy and correspondingly reduce the dissipated energy. With this consideration, this paper particularly investigates a train timetable problem in a subway system, which is equipped with a series of energy storage devices at stations. A nonlinear integer programming model is formulated to maximize the utilization of regenerative braking energy. An effective algorithm is designed to obtain the optimal train timetables. Finally, some experiments are implemented to illustrate the proposed approaches and demonstrate the feasibility and effectiveness of energy storage devices.