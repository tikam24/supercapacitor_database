Traditional hierarchical control of the microgrid does not consider the energy storage status of a distributed hybrid energy storage system. This leads to the inconsistency of the remaining capacity of the energy storage system in the process of system operation, which is not conducive to the safe and stable operation of the system. In this paper, an improved hierarchical control strategy is proposed: the first allocation layer completes the allocation between the distribution energy storage systems considering the state of hybrid energy storage systems, and the second allocation layer realizes the allocation within the hybrid energy storage systems based on variable time constant low-pass filtering. Considering the extreme conditions of energy storage systems, the transfer current is introduced in the second allocation process. The SOC (stage of charge) of the supercapacitor is between 40% and 60%, which ensures that the supercapacitor has enough margin to respond to the power demand. An example of a 300 MW photovoltaic microgrid system in a certain area is analyzed. Compared with the traditional hierarchical control, the proposed control strategy can reduce the SOC change of a hybrid energy storage system by 9% under the same conditions, and make the supercapacitor active after power stabilization, which is helpful to the stable operation of the microgrid.