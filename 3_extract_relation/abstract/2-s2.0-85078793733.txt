Taking Guangzhou Metro Line 4 as an example, the application of supercapacitor energy recovery system in rail transit is studied. Based on the designed energy storage device, the control strategy optimization is aimed at reducing energy loss on line resistance and stabilizing voltage of pantograph. According to the real-time power of vehicle brake and the method of calculating dynamic threshold, the improved control scheme is proposed under the condition of single vehicle brake and multi-vehicle brake respectively, and the effect of braking energy recovery is optimized. At last, the feasibility of it is verified by simulation.