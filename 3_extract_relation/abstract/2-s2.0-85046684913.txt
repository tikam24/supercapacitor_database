The upgrade of power systems in the last years due to the proliferation of distributed generation with renewable energy sources, active users and electric vehicles has become a challenge. In this new scenario, prosumers play an important role in order to buffer the consumption curve and, therefore, contributing to the grid requirements. Special attention is attracted by photovoltaic (PV) arrays integrated in residential buildings, because they can be complemented with energy storage systems (ESSs), such as batteries or ultracapacitors (UCs) or even a combination of both, with the aim to achieve that customers could manage their energy. The above reasons justify the need of an energy management system (EMS) that coordinates the operation of the energy storage devices in an optimized way, as they are expensive. In this paper, a comprehensive control system is proposed to exchange energy between the hybrid storage devices (batteries and UCs) of two dwells with PV installations in order to increase the availability of their ESSs and support the energy requirements during the most time possible, optimizing sizes and costs and avoiding saturation.