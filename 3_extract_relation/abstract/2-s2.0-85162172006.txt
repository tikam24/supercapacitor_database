To achieve optimal real-time power allocation in electric vehicles, a two-layer adaptive dynamic programming (DP) optimization energy management strategy (EMS) has been proposed. The upper layer uses learning vector quantization (LVQ) to produce real-time driving pattern recognition (DPR) results. The method determines 10 characteristic parameters for training the recognition network and the length of the sampling window is 120 s. The typical driving cycles are divided into different levels of blocks to identify the real-time DPR level. The lower layer adopts the optimization strategy of DP extraction to adjust the power distribution between the battery pack and the supercapacitor pack according to the recognition results. DP is used to define a cost function to minimize the energy loss of the hybrid energy storage system (HESS) and optimize the battery usage range in the system. The near-optimal real-time EMS is extracted by analyzing the DP control behavior of the battery under the layered state of charge (SOC). The simulation results indicate that the proposed new rule control based on DP optimization (NRB) EMS improves the system efficiency by 10 % compared with the original rule-based (RB) EMS under different temperatures and DPR levels. In addition, the system efficiency gap is controlled at 3 % compared with DP.