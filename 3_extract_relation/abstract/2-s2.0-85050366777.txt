The new approach to energy management issues makes Energy Storage Systems an interesting subject for both researchers and industries. One of the most important consumers of electric energy in urban areas is electric railways (metro trains). Thanks to regenerative braking, there is possibility of reusing braking energy by storing and using it again in acceleration period. Designing, sizing, and controlling such system is still an open discussion. In this paper a new control strategy is proposed based on average modeling of the converter between energy storage and dc grid. The simulation in MATLAB-Simulink is presented, all overhead and metro train data are from Mashhad metro line, and as a result of the proposed control strategy, voltage regulation, energy saving and peak power shaving is obtained.