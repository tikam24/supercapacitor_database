A small single-phase fuel cell based energy generation and compensation system is proposed in this paper. The power conditioning unit of the system comprises a grid-interfacing inverter and a three-port bidirectional converter which connects a fuel cell and supercapacitor to the inverter. The system can operate in both island and grid-connected modes. By taking advantage of the transient storage capability offered by the supercapacitor, the function of reactive power compensation is integrated into the system. Simultaneously, the inverter is operated as a shunt active power filter and, by means of a proposed control strategy, compensates for reactive and harmonic current demanded by local loads. The system is suitable for residential applications and can improve the quality of a weak power grid. Simulation and experimental results show the validity and feasibility of the proposed system. Â© 2006 IEEE.