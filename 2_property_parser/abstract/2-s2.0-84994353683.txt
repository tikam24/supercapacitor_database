This paper proposes a new architecture for a residential microgrid with hybrid energy storage system and a control algorithm to integrate it with utility grid. The proposed architecture has multiple DC outputs and an AC output to feed various DC and AC loads in the microgrid. This architecture with proposed control algorithm achieves continuous and reliable power supply to local loads in a residential microgrid and export/ import power to/from grid. The proposed control algorithm considers the PV variations, grid availability and variations in local loads. In the proposed system multiple dc outputs i.e 200V and 48V dc are employed to supply high power DC loads and critical/low power DC loads respectively. The control algorithm always maintains the 48V DC bus on, so that the critical/low power DC loads in the microgrid are continuously supplied power. A single phase voltage source converter(VSC) transfers real power between DC grid and utility grid and supplies power to local AC loads. It also provides ancillary services such as reactive power support and unity power factor and harmonic mitigation at the point of common coupling (PCC).