A simple, cost-effective and efficient approach is highly in demand for high yield preparation of hierarchical porous carbons. Here, we report a new method of in situ generated MgO or CaCO3 template coupled with KOH activation to prepare various porous carbons with high carbon yield (20%–50%) via directly pyrolyzing the mixture of polymers, template precursors, coal tar pitch and KOH. The influence of polymers, template precursors and KOH on the morphology, surface area, pore structure and supercapacitor performance have been studied and discussed in detail. These as-prepared porous carbons possess high surface area (805–1525 m2 g−1), hierarchical pores composed of micropores, small mesopores and macropores, and high oxygen doping (10.16–13.51 wt%), which endow Cx-y-a with superior capacitive performance. The CPVA-Mg(AC)2-a, CRF-Mg(AC)2-a, CMF-MgCl2-a and CMF-Ca(AC)2-a electrodes exhibit high specific capacitance of 350, 321, 329 and 311 F g−1 at 1 A g−1 and satisfying rate performance of 298, 276, 285 and 269 F g−1 corresponding to 85.1%, 86%, 86.6% and 86.5% retention at 20 A g−1. The CPVA-Mg(AC)2-a electrode shows specific capacitance as high as 251 F g−1 at 1 A g−1 and excellent rate capability of 90% retention at the large current density of 10 A g−1 in two electrode system. The CPVA-Mg(AC)2-a symmetrical supercapacitor presents a high energy density of 22.3 Wh kg−1 at 876 W kg−1 in 1 M Na2SO4 electrolyte. The present work highlights the in situ templating coupled with KOH activation strategy as a facile protocol for high yield production of porous carbon materials with excellent performance for supercapacitors.