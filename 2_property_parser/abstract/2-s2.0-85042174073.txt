One of the most important issues in power systems is the energy. Due to the fossil fuel downfall, global warming and greenhouse effect which are important environmental effects of fossil fuel burning to produce energy and energy price variation, energy saving, and recycling in industry especially in electrical vehicles and electrical trains are very important and vital. In this paper, the main aim is using a battery and a supercapacitor for train kinetic energy recovery in the braking mode and grid demand reduction in the acceleration mode. In this regard, a new DC-DC converter is proposed. An algorithm control that manages energy flow between the battery and super-capaciror (SC) in the proposed converter is designed. The control method is based on the sliding mode. Because of immeasurable internal and initial voltage of the supercapacitor, an observer extracts the internal voltage of the supercapacitor. In addition, acceleration and braking conditions of electrical trains and energy storage systems are simulated in MATLAB Simulink, and effectiveness of the proposed converter, energy management algorithm, and control system in different phases has been proven.