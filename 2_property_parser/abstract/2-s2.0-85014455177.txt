In this work, an optimal control (under constraints) based on the Pontryagin's maximum principle is used to optimally manage energy flows in a basic PEM (Proton Exchange Membrane) fuel cells system associated to lithium-ion batteries and supercapacitors through a common DC bus having a voltage to stabilize using the differential flatness approach. The adaptation of voltage levels between different sources and load is ensured by use of three DCDC converters, one boost connected to the PEM fuel cells, while the two others are buck/boost and connected to the lithium-ion batteries and supercapacitors. The aim of this paper is to develop an energy management strategy that is able to satisfy the following objectives: - Impose the power requested by a habitat (representing the load) according to a proposed daily consumption profile, - Keep fuel cells working at optimal power delivery conditions, - Maintain constant voltage across the common DC bus, - Stabilize the batteries voltage and stored quantity of charge at desired values given by the optimal control. Results obtained under MATLAB/Simulink environment prove that the cited objectives are satisfied, validating then, effectiveness and complementarity between the optimal and flatness concepts proposed for energy management. Note that this study is currently in experimentally validation within MSE Laboratory.