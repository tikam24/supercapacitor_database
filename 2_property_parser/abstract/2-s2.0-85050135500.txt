Distributed generators are unable to provide enough inertia and damping for the grid with high permeability of the power electronic device, which has a tremendous impact on the frequency stability. Virtual synchronous generator (VSG) can simulate the output characteristics of synchronous generator by novel control strategy, which improve the friendliness of distributed generator to the grid. Energy storage system is the physical basic for the implementation of VSG. This paper introduces the working principle of VSG and the configuration of the energy storage system. This paper propose a control strategy based on the topology of hybrid energy storage system in the DC side with battery and ultracapacitor. The battery provides the power corresponding to the low frequency part of the grid frequency deviation. Ultracapacitor provides high frequency variation power due to frequency fluctuations. Finally, in order to verify the correctness and validity of the proposed control strategy, a simulation model is established in Matlab/simulation in three cases.