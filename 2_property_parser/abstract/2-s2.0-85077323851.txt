This paper proposes a new method for configuring hybrid energy storage systems on the user side with a distributed renewable energy power station. To reasonably configure the hybrid energy storage system, this paper divides the whole optimization into two stages from the two dimensions of capacity and power: supercapacitor and battery optimization. To minimize the fluctuation of new energy output when the user's investment is as small as possible, a dual agent fuzzy optimization algorithm is used in the configuration of the supercapacitor. When the battery is configured, the optimization objective is to maximize the user's income and minimize the number of charges and discharges in an optimization cycle. By dividing two objective functions, multi-objective optimization is integrated into single-objective optimization, the battery life is extended, and the total revenue of the user in the whole life cycle is increased.