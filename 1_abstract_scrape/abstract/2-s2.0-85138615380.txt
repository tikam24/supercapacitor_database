The access of high permeability of renewable energy to wind-solar-storage microgrid poses a huge challenge to its economic operation. To solve this problem, the two-level scheduling strategy of microgrid considering uncertainty of source-load prediction is proposed. In the day-ahead scheduling stage, the stochastic optimal scheduling model based on multi-scenario technology is constructed taking the minimum expected operating cost in multi-scenarios as the optimization objective. The scenario analysis method is used to analyze the day-ahead prediction of wind power and photovoltaic, together with load demand. Then, the power balance equation with uncertain variables in multi-scenarios is established, and it is relaxed to inequality and used as a random event to satisfy the chance constraint with high probability. In addition, the reliability constraint model of spinning reserve capacity is constructed by chance-constrained programming, so that the microgrid can operate reliably at a certain confidence level. In the intra-day scheduling stage, an intra-day rolling scheduling model combined with an adaptive wavelet packet algorithm is proposed. The adaptive wavelet packet algorithm is used to dynamically extract the power deviation between the ultra-short-term prediction data in each control cycle and the day-ahead scheduling plan, which is suppressed by the battery, supercapacitor and main grid.