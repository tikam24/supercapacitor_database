According to different features of energy-based energy storage and power-based energy storage in hybrid energy storage system an economic optimization model of microgrid, which corresponds with actual demand, is established. Based on different time scales the day-ahead and real-time scheduling strategies are proposed. Considering poor prediction accuracy of day-ahead scheduling, using chance constrained programming and taking satisfying the demand on reserve under a certain confidence level as reliability constraint and taking the minimum operation cost as the optimization objective and utilizing the difference of TOU price the optimal coordination of the output of micro energy sources and energy storage systems are performed. In allusion to power fluctuation brought about by such uncertain factors as wind turbine, photovoltaic generation and load, in real-time scheduling the first-order low-pass filtering algorithm is applied to smooth the power fluctuation, and the moving average filtering method is utilized to reasonably allocate the post-filtering fluctuating power among hybrid energy storage systems to make the battery energy storage system taking on more low-frequency power fluctuation and the supercapacitor taking on high-frequency power fluctuation. The real-time scheduling is carried out according to day-ahead plan to monitor operating states of all units in real time and to modify the deviation of day-ahead plan caused by the cumulation of power fluctuation in time.