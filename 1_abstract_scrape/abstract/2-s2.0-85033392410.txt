Nitrogen-phosphorus co-doped hierarchical porous carbon microspheres (NPHCMs) have been prepared through combining polymerization of melamine-formaldehyde resin with co-assembly of colloidal silica nanospheres by using melamine and formaldehyde as carbon and nitrogen sources, and 1-hydroxyethylidene-1,1-diphosphonic acid as the catalyst and phosphorus source. After carbonization and silica removal, the obtained NPHCMs possess high surface areas of 563-720 m2 g-1 with micropores, bi-model mesopores (2.6 and 3.7 nm) and macropores (250 nm) distributed in the shell. Owing to the incorporation of abundant N (7.0-15.35%) and P (0.09-0.16%) in the carbon matrix and the interconnected micro-, meso-, and macroporous structure, the NPHCMs exhibit good capacitive performances. The 800 Â°C-carbonized sample shows a high specific capacitance and good rate capability (200 F g-1 at 0.5 A g-1 and 132 F g-1 at 20 A g-1) in 6 M KOH electrolyte. The all-solid-state electrode fabricated from the NPHCMs presents a high specific capacitance of 180 F g-1 at 0.5 A g-1 and long cycle life with 91% capacitance retention after 5000 cycles at 0.5 A g-1 in a polyvinyl alcohol/KOH gel electrolyte, suggesting its great potential for the development of high-performance energy storage devices.