Due to the short distance between stations, frequent acceleration and braking for urban rail trains cause voltage fluctuation in the traction network and the regenerative braking energy loss. In this study, a hybrid energy storage system (HESS) was proposed to recover braking energy and stabilize the traction network voltage, where the on-board ultracapacitors were used to accommodate the rapid exchange of acceleration and braking energy of the permanent magnet traction system while the lithium batteries installed in the bilateral stations provided stable and long-lasting energy exchange, which can stabilize traction network voltage and be charged at off-peak night time. In order to realize the energy coordinated control between the permanent magnet traction system and HESS, a real-time energy management strategy was proposed to dynamically allocate the traction power based on the principle of giving priority to on-board ultracapacitors while lithium batteries as auxiliary power supply. Moreover, the charging and discharging voltage thresholds of the lithium batteries were dynamically set according to train positions and their charge status. Comparing with the traditional strategies, the RT-LAB semi-physical real-time simulation shows that the proposed strategy can provide more effective energy allocation, and stabilize the voltage fluctuation while maximizing the energy saving.