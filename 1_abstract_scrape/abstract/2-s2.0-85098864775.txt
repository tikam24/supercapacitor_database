Due to weather, seasons, and other factors, photovoltaic power generation cannot be predicted accurately. A Hybrid energy storage system can effectively reduce the impact of unbalanced power generated by this situation. In this paper, retired power batteries and super capacitors are used to form an energy storage system. A community system model is established. An improved lumped average empirical mode decomposition algorithm is used to decompose unbalanced power. Hilbert transform is used to obtain the reference boundary frequency of the energy storage system. Taking the minimum community investment cost as the objective function, a dimensional gravity center reverse mutation particle swarm optimization algorithm is used to solve the problem. The capacity allocation with good investment economy is determined. Two cases of conventional battery energy storage and retired power batteries are analyzed through numerical simulation. The results show that the hybrid energy storage system based on retired power batteries proposed in this paper can reduce investment and has a better economy.