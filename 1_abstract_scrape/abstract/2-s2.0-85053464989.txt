In an energy harvesting communication system, the main challenge is to improve network lifetime and maximize throughput by allocating optimal power over a finite span of time, with varying channel and energy.Considering (1) causal state information (SI) of channel and energy (CSI and ESI) and (2) energy storage device imperfections, the problem of power allocation is solved using dynamic programming.As compared to the battery, the supercapacitor is a good alternative for network lifetime improvement, but the imperfections hinder the performance. In this paper, imperfections (storage inefficiency and energy leakage equation) are modeled for supercapacitor and battery. We consider a constant leakage rate for battery.Also, the imperfections of battery and supercapacitor are compared to find which imperfection of supercapacitor is a bottleneck in system performance in different settings (varying channel conditions).The analysis is supported by numerical results.