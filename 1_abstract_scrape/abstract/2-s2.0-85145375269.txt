Hybrid energy storage system (HESS) composed of battery and supercapacitor can effectively compensate the power deviation between supply and demand in distributed generation system (DGs). However, the popularization application of which is limited by the high cost of capacity configuration and subsequent maintenance. Hence, considering dynamic change of frequency characteristics of power deviation, a two-level optimization model for power programming and capacity configuration of HESS is established. In the outer layer, aiming at minimizing the allocation of the capacity, power allocation strategy of HESS based on adaptive filtering is proposed, which adaptively adjusts the sliding window of moving average filter (MAF), and decomposes the supplyâ€“demand power deviation sequence into the scope of battery and supercapacitor. In the inner layer, considering grid-connected power fluctuations, a full life cycle HESS capacity optimization model is proposed. The model aims at the total cost of HESS and the renewable energy utilization (REU), and uses non-dominated sorting genetic algorithm II (NSGA-II) to solve the model. Furthermore, a case is introduced to verify the feasibility of the proposed strategy and the effectiveness of the model solution.